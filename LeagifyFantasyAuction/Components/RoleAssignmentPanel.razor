@using System.Net.Http.Json
@using System.Text.Json
@inject HttpClient Http
@inject IJSRuntime JSRuntime

<div class="role-assignment-panel">
    <FluentCard>
        <div class="panel-header">
            <FluentLabel Typo="Typography.Subject">
                Participant Role Management
            </FluentLabel>
            <FluentLabel Style="color: #666; margin-top: 4px;">
                Assign roles and teams to auction participants
            </FluentLabel>
        </div>

        @if (isLoading)
        {
            <div class="loading-container">
                <FluentProgressRing />
                <FluentLabel>Loading participants...</FluentLabel>
            </div>
        }
        else if (participants.Any())
        {
            <div class="participants-table-container">
                <table class="participants-table">
                    <thead>
                        <tr>
                            <th>Display Name</th>
                            <th>Team Assignment</th>
                            <th>Role</th>
                            <th>Status</th>
                            <th>Assign Role</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var participant in participants)
                        {
                            <tr>
                                <td>@participant.DisplayName</td>
                                
                                <!-- Team Assignment Column -->
                                <td>
                                    @{
                                        var teamRoles = participant.Roles.Where(r => !string.IsNullOrEmpty(r.TeamName)).ToList();
                                    }
                                    @if (teamRoles.Any())
                                    {
                                        <div class="team-assignments">
                                            @foreach (var teamRole in teamRoles)
                                            {
                                                <FluentBadge Appearance="Appearance.Accent" 
                                                             BackgroundColor="#0078d4"
                                                             Color="white"
                                                             Style="font-size: 12px; font-weight: bold; margin: 2px;">
                                                    @teamRole.TeamName
                                                    <FluentButton Appearance="Appearance.Stealth"
                                                                  IconStart="@(new Icons.Regular.Size12.Dismiss())"
                                                                  Style="margin-left: 4px; min-width: auto; padding: 0 4px; color: white;"
                                                                  OnClick="@(() => RemoveRole(participant.UserId, teamRole.UserRoleId))"
                                                                  Title="Remove team assignment" />
                                                </FluentBadge>
                                            }
                                        </div>
                                    }
                                    else
                                    {
                                        <span class="no-team" style="color: #666; font-style: italic;">No team assigned</span>
                                    }
                                </td>
                                
                                <!-- Role Column -->
                                <td>
                                    @if (participant.Roles.Any())
                                    {
                                        <div class="roles-container">
                                            @foreach (var role in participant.Roles)
                                            {
                                                <FluentBadge Appearance="@GetRoleAppearance(role.Role)" 
                                                             BackgroundColor="@GetRoleColor(role.Role)"
                                                             Color="white"
                                                             Style="font-size: 11px; margin: 2px;">
                                                    @GetRoleDisplayName(role.Role)
                                                    <FluentButton Appearance="Appearance.Stealth"
                                                                  IconStart="@(new Icons.Regular.Size12.Dismiss())"
                                                                  Style="margin-left: 4px; min-width: auto; padding: 0 4px;"
                                                                  OnClick="@(() => RemoveRole(participant.UserId, role.UserRoleId))"
                                                                  Title="Remove this role" />
                                                </FluentBadge>
                                            }
                                        </div>
                                    }
                                    else
                                    {
                                        <span class="no-roles" style="color: #666; font-style: italic;">No roles assigned</span>
                                    }
                                </td>
                                
                                <!-- Status Column -->
                                <td>
                                    <FluentBadge Appearance="@(participant.IsConnected ? Appearance.Accent : Appearance.Neutral)"
                                                 BackgroundColor="@(participant.IsConnected ? "#28a745" : "#6c757d")"
                                                 Color="white">
                                        @(participant.IsConnected ? "Online" : "Offline")
                                    </FluentBadge>
                                    @if (participant.IsReconnectionPending)
                                    {
                                        <FluentBadge Appearance="Appearance.Neutral" BackgroundColor="#ffc107" Color="black" Style="margin-left: 4px;">
                                            Reconnection Pending
                                        </FluentBadge>
                                    }
                                </td>
                                
                                <td>
                                    <div class="role-assignment">
                                        <select @onchange="@(e => SetSelectedRole(participant.UserId, e.Value?.ToString() ?? string.Empty))"
                                                value="@GetSelectedRole(participant.UserId)"
                                                class="role-select">
                                            <option value="">Select role...</option>
                                            @foreach (var role in roleOptions)
                                            {
                                                <option value="@role">@role</option>
                                            }
                                        </select>
                                        
                                        @if (GetSelectedRole(participant.UserId) == "TeamCoach" || GetSelectedRole(participant.UserId) == "ProxyCoach")
                                        {
                                            <select @onchange="@(e => SetSelectedTeamIdString(participant.UserId, e.Value?.ToString() ?? string.Empty))"
                                                    value="@GetSelectedTeamIdString(participant.UserId)"
                                                    class="team-select">
                                                <option value="">Select team...</option>
                                                @foreach (var teamId in availableTeamIds)
                                                {
                                                    <option value="@teamId.ToString()">@GetTeamName(teamId)</option>
                                                }
                                            </select>
                                        }
                                    </div>
                                </td>
                                
                                <td>
                                    <div class="actions-buttons">
                                        <FluentButton Appearance="Appearance.Accent"
                                                      IconStart="@(new Icons.Regular.Size16.PersonAdd())"
                                                      Size="ButtonSize.Small"
                                                      OnClick="@(() => AssignRole(participant.UserId))"
                                                      Disabled="@(string.IsNullOrEmpty(GetSelectedRole(participant.UserId)))"
                                                      Loading="@(assigningRoles.Contains(participant.UserId))"
                                                      Style="margin-bottom: 4px;">
                                            Assign
                                        </FluentButton>
                                        
                                        <FluentButton Appearance="Appearance.Stealth"
                                                      IconStart="@(new Icons.Regular.Size16.PersonDelete())"
                                                      Size="ButtonSize.Small"
                                                      OnClick="@(() => participant.IsConnected ? MarkUserOffline(participant.UserId, participant.DisplayName) : DeleteUser(participant.UserId, participant.DisplayName))"
                                                      Loading="@(deletingUsers.Contains(participant.UserId))"
                                                      Title="@(participant.IsConnected ? "Mark as offline" : "Delete disconnected user")">
                                            @(participant.IsConnected ? "Mark Offline" : "Delete")
                                        </FluentButton>
                                    </div>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        }
        else
        {
            <FluentMessageBar Intent="MessageIntent.Info">
                No participants have joined this auction yet.
            </FluentMessageBar>
        }

        @if (!string.IsNullOrEmpty(errorMessage))
        {
            <FluentMessageBar Intent="MessageIntent.Error" Style="margin-top: 16px;">
                @errorMessage
            </FluentMessageBar>
        }

        @if (!string.IsNullOrEmpty(successMessage))
        {
            <FluentMessageBar Intent="MessageIntent.Success" Style="margin-top: 16px;">
                @successMessage
            </FluentMessageBar>
        }
    </FluentCard>
</div>

@code {
    [Parameter] public int AuctionId { get; set; }
    [Parameter] public EventCallback OnRoleAssigned { get; set; }

    private List<ParticipantDto> participants = new();
    private IQueryable<ParticipantDto> participantsQueryable => participants.AsQueryable();
    private List<TeamDto> availableTeams = new();
    private List<int> availableTeamIds = new();
    private List<string> availableTeamIdStrings = new();
    
    private bool isLoading = true;
    private string errorMessage = string.Empty;
    private string successMessage = string.Empty;
    
    private readonly List<string> roleOptions = new() { "AuctionMaster", "TeamCoach", "ProxyCoach", "Viewer" };
    private readonly Dictionary<int, string> selectedRoles = new();
    private readonly Dictionary<int, int> selectedTeamIds = new();
    private readonly HashSet<int> assigningRoles = new();
    private readonly HashSet<int> deletingUsers = new();

    protected override async Task OnInitializedAsync()
    {
        await LoadData();
    }

    public async Task RefreshData()
    {
        await LoadData();
        StateHasChanged();
    }

    private async Task LoadData()
    {
        try
        {
            isLoading = true;
            errorMessage = string.Empty;
            StateHasChanged();

            var token = await JSRuntime.InvokeAsync<string?>("localStorage.getItem", "managementToken");
            if (string.IsNullOrEmpty(token))
            {
                errorMessage = "Management authentication required";
                return;
            }

            Http.DefaultRequestHeaders.Remove("X-Management-Token");
            Http.DefaultRequestHeaders.Add("X-Management-Token", token);

            // Load participants - Remove auth headers for this public endpoint
            Http.DefaultRequestHeaders.Remove("X-Management-Token");
            var participantsResponse = await Http.GetAsync($"/api/auction/{AuctionId}/participants");
            if (participantsResponse.IsSuccessStatusCode)
            {
                participants = await participantsResponse.Content.ReadFromJsonAsync<List<ParticipantDto>>() ?? new();
                Console.WriteLine($"Loaded {participants.Count} participants with team data");

                // Debug log team assignments
                foreach (var participant in participants)
                {
                    var teamRoles = participant.Roles?.Where(r => !string.IsNullOrEmpty(r.TeamName)).ToList() ?? new List<RoleDto>();
                    Console.WriteLine($"Participant {participant.DisplayName}: {teamRoles.Count} team assignments");
                    foreach (var role in teamRoles)
                    {
                        Console.WriteLine($"  - Team: {role.TeamName}, Role: {role.Role}");
                    }
                }
            }
            else
            {
                Console.WriteLine($"Failed to load participants: {participantsResponse.StatusCode}");
                errorMessage = $"Failed to load participants: {participantsResponse.StatusCode}";
            }

            // Re-add management token for other management endpoints
            if (!string.IsNullOrEmpty(token))
            {
                Http.DefaultRequestHeaders.Add("X-Management-Token", token);
            }

            // Load available teams (optional for now - teams will be created during auction setup)
            try
            {
                Console.WriteLine($"üîç Loading teams for auction {AuctionId}...");
                var teamsResponse = await Http.GetAsync($"/api/management/auctions/{AuctionId}/teams");
                if (teamsResponse.IsSuccessStatusCode)
                {
                    var teamsData = await teamsResponse.Content.ReadFromJsonAsync<ManageTeamsResponse>();
                    var rawTeams = teamsData?.Teams ?? new();
                    Console.WriteLine($"üìã Raw teams from API: {string.Join(", ", rawTeams.Select(t => $"{t.TeamName}(ID:{t.TeamId})"))}");

                    // Ensure no duplicates by grouping by TeamId and taking first
                    availableTeams = rawTeams
                        .GroupBy(t => t.TeamId)
                        .Select(g => g.First())
                        .OrderBy(t => t.NominationOrder)
                        .ToList();

                    Console.WriteLine($"‚úÖ Final available teams: {string.Join(", ", availableTeams.Select(t => $"{t.TeamName}(ID:{t.TeamId})"))}");

                    // Update cached lists to avoid computed property issues
                    availableTeamIds = availableTeams.Select(t => t.TeamId).ToList();
                    availableTeamIdStrings = availableTeams.Select(t => t.TeamId.ToString()).ToList();

                    // Debug the dropdown data
                    Console.WriteLine($"üéØ Available Team IDs for dropdown: [{string.Join(", ", availableTeamIds)}]");
                    Console.WriteLine($"üéØ Team names for dropdown:");
                    foreach (var teamId in availableTeamIds)
                    {
                        Console.WriteLine($"   TeamId {teamId} -> {GetTeamName(teamId)}");
                    }
                }
                else
                {
                    Console.WriteLine($"‚ùå Teams API failed: {teamsResponse.StatusCode}");
                    // Teams endpoint doesn't exist yet - create placeholder teams for now
                    availableTeams = CreatePlaceholderTeams();
                    availableTeamIds = availableTeams.Select(t => t.TeamId).ToList();
                    availableTeamIdStrings = availableTeams.Select(t => t.TeamId.ToString()).ToList();
                }
            }
            catch (Exception ex)
            {
                Console.WriteLine($"‚ùå Teams API exception: {ex.Message}");
                // If teams API fails, create placeholder teams
                availableTeams = CreatePlaceholderTeams();
                availableTeamIds = availableTeams.Select(t => t.TeamId).ToList();
                availableTeamIdStrings = availableTeams.Select(t => t.TeamId.ToString()).ToList();
            }
        }
        catch (Exception ex)
        {
            errorMessage = $"Error loading data: {ex.Message}";
            Console.WriteLine($"Error loading role assignment data: {ex}");
        }
        finally
        {
            isLoading = false;
            StateHasChanged();
        }
    }

    private async Task AssignRole(int userId)
    {
        if (!selectedRoles.TryGetValue(userId, out var role) || string.IsNullOrEmpty(role))
        {
            return;
        }

        try
        {
            assigningRoles.Add(userId);
            errorMessage = string.Empty;
            successMessage = string.Empty;
            StateHasChanged();

            var token = await JSRuntime.InvokeAsync<string?>("localStorage.getItem", "managementToken");
            if (string.IsNullOrEmpty(token))
            {
                errorMessage = "Management authentication required";
                return;
            }

            Http.DefaultRequestHeaders.Remove("X-Management-Token");
            Http.DefaultRequestHeaders.Add("X-Management-Token", token);

            var request = new AssignRoleRequest
            {
                Role = role,
                TeamId = (role == "TeamCoach" || role == "ProxyCoach") && selectedTeamIds.TryGetValue(userId, out var teamId) ? teamId : null
            };

            var response = await Http.PostAsJsonAsync($"/api/management/auctions/{AuctionId}/users/{userId}/roles", request);
            
            if (response.IsSuccessStatusCode)
            {
                var participant = participants.FirstOrDefault(p => p.UserId == userId);
                if (participant != null)
                {
                    successMessage = $"Successfully assigned {GetRoleDisplayName(role)} to {participant.DisplayName}";
                }

                // Clear selections for this user
                selectedRoles.Remove(userId);
                selectedTeamIds.Remove(userId);

                // Refresh data to show updated roles
                await LoadData();
                
                // Notify parent component
                if (OnRoleAssigned.HasDelegate)
                {
                    await OnRoleAssigned.InvokeAsync();
                }
            }
            else
            {
                var error = await response.Content.ReadAsStringAsync();
                errorMessage = $"Failed to assign role: {error}";
            }
        }
        catch (Exception ex)
        {
            errorMessage = $"Error assigning role: {ex.Message}";
            Console.WriteLine($"Error assigning role: {ex}");
        }
        finally
        {
            assigningRoles.Remove(userId);
            StateHasChanged();
        }
    }

    private async Task RemoveRole(int userId, int userRoleId)
    {
        try
        {
            errorMessage = string.Empty;
            successMessage = string.Empty;

            var token = await JSRuntime.InvokeAsync<string?>("localStorage.getItem", "managementToken");
            if (string.IsNullOrEmpty(token))
            {
                errorMessage = "Management authentication required";
                return;
            }

            Http.DefaultRequestHeaders.Remove("X-Management-Token");
            Http.DefaultRequestHeaders.Add("X-Management-Token", token);

            var response = await Http.DeleteAsync($"/api/management/auctions/{AuctionId}/users/{userId}/roles/{userRoleId}");
            
            if (response.IsSuccessStatusCode)
            {
                var participant = participants.FirstOrDefault(p => p.UserId == userId);
                if (participant != null)
                {
                    successMessage = $"Successfully removed role from {participant.DisplayName}";
                }

                // Refresh data to show updated roles
                await LoadData();
                
                // Notify parent component
                if (OnRoleAssigned.HasDelegate)
                {
                    await OnRoleAssigned.InvokeAsync();
                }
            }
            else
            {
                var error = await response.Content.ReadAsStringAsync();
                errorMessage = $"Failed to remove role: {error}";
            }
        }
        catch (Exception ex)
        {
            errorMessage = $"Error removing role: {ex.Message}";
            Console.WriteLine($"Error removing role: {ex}");
        }
        finally
        {
            StateHasChanged();
        }
    }

    private async Task DeleteUser(int userId, string displayName)
    {
        try
        {
            if (!await JSRuntime.InvokeAsync<bool>("confirm", $"Are you sure you want to delete user '{displayName}'? This will remove them completely from the auction."))
            {
                return;
            }

            deletingUsers.Add(userId);
            errorMessage = string.Empty;
            successMessage = string.Empty;
            StateHasChanged();

            var token = await JSRuntime.InvokeAsync<string?>("localStorage.getItem", "managementToken");
            if (string.IsNullOrEmpty(token))
            {
                errorMessage = "Management authentication required";
                return;
            }

            Http.DefaultRequestHeaders.Remove("X-Management-Token");
            Http.DefaultRequestHeaders.Add("X-Management-Token", token);

            var response = await Http.DeleteAsync($"/api/management/auctions/{AuctionId}/users/{userId}");
            
            if (response.IsSuccessStatusCode)
            {
                successMessage = $"Successfully deleted user '{displayName}'";
                
                // Refresh data to show updated participant list
                await LoadData();
                
                // Notify parent component
                if (OnRoleAssigned.HasDelegate)
                {
                    await OnRoleAssigned.InvokeAsync();
                }
            }
            else
            {
                var error = await response.Content.ReadAsStringAsync();
                errorMessage = $"Failed to delete user: {error}";
            }
        }
        catch (Exception ex)
        {
            errorMessage = $"Error deleting user: {ex.Message}";
            Console.WriteLine($"Error deleting user: {ex}");
        }
        finally
        {
            deletingUsers.Remove(userId);
            StateHasChanged();
        }
    }

    private async Task MarkUserOffline(int userId, string displayName)
    {
        try
        {
            deletingUsers.Add(userId);
            errorMessage = string.Empty;
            successMessage = string.Empty;
            StateHasChanged();

            var token = await JSRuntime.InvokeAsync<string?>("localStorage.getItem", "managementToken");
            if (string.IsNullOrEmpty(token))
            {
                errorMessage = "Management authentication required";
                return;
            }

            Http.DefaultRequestHeaders.Remove("X-Management-Token");
            Http.DefaultRequestHeaders.Add("X-Management-Token", token);

            // Call API to mark user as offline (we'll need to create this endpoint)
            var response = await Http.PostAsync($"/api/management/auctions/{AuctionId}/users/{userId}/offline", null);
            
            if (response.IsSuccessStatusCode)
            {
                successMessage = $"Marked user '{displayName}' as offline";
                
                // Refresh data to show updated status
                await LoadData();
                
                // Notify parent component
                if (OnRoleAssigned.HasDelegate)
                {
                    await OnRoleAssigned.InvokeAsync();
                }
            }
            else
            {
                var error = await response.Content.ReadAsStringAsync();
                errorMessage = $"Failed to mark user offline: {error}";
            }
        }
        catch (Exception ex)
        {
            errorMessage = $"Error marking user offline: {ex.Message}";
            Console.WriteLine($"Error marking user offline: {ex}");
        }
        finally
        {
            deletingUsers.Remove(userId);
            StateHasChanged();
        }
    }

    private string GetSelectedRole(int userId) => selectedRoles.TryGetValue(userId, out var role) ? role : string.Empty;
    private int GetSelectedTeamId(int userId) => selectedTeamIds.TryGetValue(userId, out var teamId) ? teamId : 0;
    private string GetSelectedTeamIdString(int userId) => GetSelectedTeamId(userId).ToString();
    
    private void SetSelectedRole(int userId, string role)
    {
        if (string.IsNullOrEmpty(role))
        {
            selectedRoles.Remove(userId);
        }
        else
        {
            selectedRoles[userId] = role;
        }
    }
    
    private void SetSelectedTeamId(int userId, int teamId)
    {
        if (teamId <= 0)
        {
            selectedTeamIds.Remove(userId);
        }
        else
        {
            selectedTeamIds[userId] = teamId;
        }
    }
    
    private void SetSelectedTeamIdString(int userId, string teamIdString)
    {
        if (int.TryParse(teamIdString, out var teamId))
        {
            SetSelectedTeamId(userId, teamId);
        }
        else
        {
            selectedTeamIds.Remove(userId);
        }
    }

    private string GetTeamName(int teamId)
    {
        return availableTeams.FirstOrDefault(t => t.TeamId == teamId)?.TeamName ?? $"Team {teamId}";
    }

    private string GetTeamNameFromString(string teamIdString)
    {
        if (int.TryParse(teamIdString, out var teamId))
        {
            return GetTeamName(teamId);
        }
        return teamIdString;
    }

    private List<TeamDto> CreatePlaceholderTeams()
    {
        // Create placeholder teams until the auction setup creates real teams
        return new List<TeamDto>
        {
            new() { TeamId = 1, TeamName = "Team 1", Budget = 200m, NominationOrder = 1, IsActive = true },
            new() { TeamId = 2, TeamName = "Team 2", Budget = 200m, NominationOrder = 2, IsActive = true },
            new() { TeamId = 3, TeamName = "Team 3", Budget = 200m, NominationOrder = 3, IsActive = true },
            new() { TeamId = 4, TeamName = "Team 4", Budget = 200m, NominationOrder = 4, IsActive = true },
            new() { TeamId = 5, TeamName = "Team 5", Budget = 200m, NominationOrder = 5, IsActive = true },
            new() { TeamId = 6, TeamName = "Team 6", Budget = 200m, NominationOrder = 6, IsActive = true }
        };
    }

    private static Appearance GetRoleAppearance(string role) => role switch
    {
        "AuctionMaster" => Appearance.Accent,
        "TeamCoach" => Appearance.Neutral,
        "ProxyCoach" => Appearance.Lightweight,
        _ => Appearance.Neutral
    };

    private static string GetRoleColor(string role) => role switch
    {
        "AuctionMaster" => "#0078d4",
        "TeamCoach" => "#107c10",
        "ProxyCoach" => "#ca5010",
        _ => "#605e5c"
    };

    private static string GetRoleDisplayName(string role) => role switch
    {
        "AuctionMaster" => "Auction Master",
        "TeamCoach" => "Team Coach",
        "ProxyCoach" => "Proxy Coach",
        "Viewer" => "Viewer",
        _ => role
    };

    // DTOs matching the API models
    private class ParticipantDto
    {
        public int UserId { get; set; }
        public string DisplayName { get; set; } = string.Empty;
        public bool IsConnected { get; set; }
        public DateTime JoinedDate { get; set; }
        public DateTime LastActiveDate { get; set; }
        public bool IsReconnectionPending { get; set; }
        public List<RoleDto> Roles { get; set; } = new();
    }

    private class RoleDto
    {
        public int UserRoleId { get; set; }
        public string Role { get; set; } = string.Empty;
        public int? TeamId { get; set; }
        public string? TeamName { get; set; }
        public DateTime AssignedDate { get; set; }
    }

    private class TeamDto
    {
        public int TeamId { get; set; }
        public string TeamName { get; set; } = string.Empty;
        public decimal Budget { get; set; }
        public int NominationOrder { get; set; }
        public bool IsActive { get; set; }
    }

    private class AssignRoleRequest
    {
        public string Role { get; set; } = string.Empty;
        public int? TeamId { get; set; }
    }

    private class ManageTeamsResponse
    {
        public List<TeamDto> Teams { get; set; } = new();
    }
}

<style>
    .role-assignment-panel {
        margin-bottom: 24px;
    }

    .panel-header {
        margin-bottom: 20px;
        padding: 20px 20px 0;
    }

    .loading-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 40px;
        gap: 12px;
    }

    .role-assignment-panel fluent-card {
        padding: 0;
        border: 1px solid #e1e1e1;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        overflow: visible; /* Allow dropdowns to extend outside the card */
    }

    .role-assignment-panel fluent-data-grid {
        padding: 0 20px 20px;
        overflow: visible; /* Allow dropdowns to extend outside the grid */
        width: 100%;
    }

    /* Responsive layout improvements */
    .role-assignment-panel {
        width: 100%;
        overflow-x: auto;
    }

    .participants-table-container {
        overflow-x: auto;
        width: 100%;
        padding: 0 20px 20px;
    }

    .participants-table {
        width: 100%;
        min-width: 1000px;
        border-collapse: collapse;
        font-size: 14px;
    }

    .participants-table th {
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        padding: 12px 8px;
        text-align: left;
        font-weight: 600;
        color: #495057;
    }

    .participants-table td {
        border: 1px solid #dee2e6;
        padding: 12px 8px;
        vertical-align: top;
        min-height: 80px;
    }

    .participants-table tr:nth-child(even) {
        background-color: #f8f9fa;
    }

    .participants-table tr:hover {
        background-color: #e9ecef;
    }

    /* Role-specific styling */
    .roles-container {
        display: flex;
        flex-wrap: wrap;
        gap: 4px;
    }

    .no-roles {
        color: #666;
        font-style: italic;
        font-size: 12px;
    }

    .role-assignment {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .role-select,
    .team-select {
        width: 100%;
        padding: 6px;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 12px;
    }

    .actions-buttons {
        display: flex;
        flex-direction: column;
        gap: 6px;
        min-width: 140px;
    }

    .actions-buttons fluent-button {
        width: 100%;
        font-size: 11px;
    }

    /* Compact badge styling */
    .role-assignment-panel fluent-badge {
        font-size: 11px;
        padding: 3px 8px;
        margin: 2px;
    }
</style>